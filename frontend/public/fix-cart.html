<!DOCTYPE html>
<html>
  <head>
    <title>Fix Cart Error</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #d9534f;
      }
      .button {
        background: #17a2b8;
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      .button:hover {
        background: #138496;
      }
      .success {
        background: #28a745;
        color: white;
        padding: 15px;
        border-radius: 5px;
        margin-top: 20px;
        display: none;
      }
      .error-box {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }
      code {
        background: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸ›’ Fix Cart Error</h1>

      <div class="error-box">
        <strong>Error:</strong> Cannot read properties of undefined (reading
        'price') <br /><br />
        This happens when cart data gets corrupted or products are missing price
        information.
      </div>

      <h2>Quick Fix:</h2>
      <ol>
        <li>Click the button below to clear your cart and fix the error</li>
        <li>Go back to the shop and add items again</li>
        <li>Your cart will work properly! âœ…</li>
      </ol>

      <button class="button" onclick="clearCart()">
        Clear Cart & Fix Error
      </button>
      <button class="button" onclick="clearAll()">
        Clear Everything (Cart + Auth)
      </button>
      <button
        class="button"
        onclick="window.location.href='http://localhost:3000'"
      >
        Go to Shop
      </button>

      <div class="success" id="successMessage">
        âœ… Success! Cart cleared and fixed.<br />
        Now go to
        <a
          href="http://localhost:3000"
          style="color: white; text-decoration: underline"
          >the shop</a
        >
        and add items again.
      </div>

      <div
        style="
          margin-top: 30px;
          padding: 15px;
          background: #e7f3ff;
          border-left: 4px solid #2196f3;
        "
      >
        <h3>What causes this?</h3>
        <ul>
          <li>
            Products were deleted from the database but remain in your cart
          </li>
          <li>Cart data structure changed</li>
          <li>Price information is missing from cart items</li>
        </ul>
        <p>
          <strong>Solution:</strong> Clear cart and re-add items with fresh
          data.
        </p>
      </div>
    </div>

    <script>
      function clearCart() {
        // Get current cart
        let cart = localStorage.getItem('cart');
        if (cart) {
          try {
            cart = JSON.parse(cart);
            // Keep shipping and payment info, just clear items
            cart.cartItems = [];
            cart.itemsPrice = '0.00';
            cart.shippingPrice = '10.00';
            cart.taxPrice = '0.00';
            cart.totalPrice = '10.00';
            localStorage.setItem('cart', JSON.stringify(cart));
          } catch (e) {
            // If parsing fails, remove completely
            localStorage.removeItem('cart');
          }
        }

        document.getElementById('successMessage').style.display = 'block';
      }

      function clearAll() {
        // Clear everything
        localStorage.clear();
        sessionStorage.clear();

        // Clear cookies
        document.cookie.split(';').forEach(function (c) {
          document.cookie = c
            .replace(/^ +/, '')
            .replace(
              /=.*/,
              '=;expires=' + new Date().toUTCString() + ';path=/'
            );
        });

        document.getElementById('successMessage').style.display = 'block';
        document.getElementById('successMessage').innerHTML =
          'âœ… Success! Everything cleared.<br>Now go to <a href="http://localhost:3000" style="color: white; text-decoration: underline;">the shop</a> and start fresh.';
      }
    </script>
  </body>
</html>
